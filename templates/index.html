<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LocaGo! - Kh√°m ph√° ƒëi·ªÉm ƒë·∫øn</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }

      body {
          font-family: -apple-system, BlinkMacSystemFont, 'Poppins', 'Segoe UI', sans-serif;
          background: #f5f5f5;
          min-height: 100vh;
      }

      @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');

      /* Header */
      header {
          background: white;
          box-shadow: 0 2px 10px rgba(0,0,0,0.1);
          padding: 15px 30px;
          position: sticky;
          top: 0;
          z-index: 1000;
      }

      .header-container {
          max-width: 1400px;
          margin: 0 auto;
          display: flex;
          justify-content: space-between;
          align-items: center;
      }

      .logo {
          font-size: 32px;
          font-weight: 700;
          color: #1C6758;
          text-decoration: none;
          font-family: 'Poppins', sans-serif;
      }

      .logo span {
          color: #8EB486;
      }

      .nav-links {
          display: flex;
          gap: 20px;
          align-items: center;
          position: relative;
      }

      .nav-links a, .nav-links button {
          text-decoration: none;
          color: #333;
          padding: 10px 18px;
          border-radius: 8px;
          transition: 0.3s;
          border: none;
          background: transparent;
          cursor: pointer;
          font-size: 15px;
          font-weight: 500;
          font-family: 'Poppins', sans-serif;
      }

      .nav-links a:hover, .nav-links button:hover {
          background: #f0f0f0;
      }

      .nav-user {
        color: #333;
        padding: 10px 18px;
        border-radius: 8px;
        font-size: 15px;
        font-weight: 500;
        font-family: 'Poppins', sans-serif;
        cursor: default;
      }

      .nav-user:hover {
        background: #f0f0f0;
      }


      .btn-primary {
          background: linear-gradient(135deg, #1C6758, #8EB486) !important;
          color: white !important;
          font-weight: 600;
      }

      /* Hamburger Menu */
      .hamburger-btn {
          font-size: 24px;
          padding: 8px 12px !important;
      }

      .dropdown-menu {
          position: absolute;
          top: 60px;
          right: 0;
          background: white;
          border-radius: 12px;
          box-shadow: 0 8px 24px rgba(0,0,0,0.15);
          padding: 10px;
          min-width: 200px;
          display: none;
          z-index: 1001;
      }

      .dropdown-menu.show {
          display: block;
          animation: fadeIn 0.2s ease;
      }

      @keyframes fadeIn {
          from { opacity: 0; transform: translateY(-10px); }
          to { opacity: 1; transform: translateY(0); }
      }

      .dropdown-menu a {
          display: block;
          padding: 12px 16px;
          border-radius: 8px;
          margin: 2px 0;
          color: #333;
      }

      .dropdown-menu a:hover {
          background: #f0f0f0;
      }

      /* Hero Section with Slideshow */
      .hero {
          position: relative;
          height: 600px;
          overflow: hidden;
          color: white;
      }

      .hero-slideshow {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          z-index: 1;
      }

      .hero-slide {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-size: cover;
          background-position: center;
          opacity: 0;
          transition: opacity 1.5s ease-in-out;
      }

      .hero-slide.active {
          opacity: 1;
      }

      .hero-overlay {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.5);
          z-index: 2;
      }

      .hero-content {
          position: relative;
          z-index: 3;
          padding: 60px 20px;
          text-align: center;
          height: 100%;
          display: flex;
          flex-direction: column;
          justify-content: center;
      }

      .hero h1 {
          font-size: 3em;
          margin-bottom: 15px;
          font-weight: 700;
          font-family: 'Poppins', sans-serif;
          text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      }

      .hero p {
          font-size: 1.2em;
          margin-bottom: 40px;
          opacity: 0.95;
          font-weight: 400;
          text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
      }

      /* Search Container */
      .search-container {
          max-width: 900px;
          margin: 0 auto;
          background: rgba(255, 255, 255, 0.95);
          border-radius: 20px;
          padding: 35px;
          box-shadow: 0 10px 40px rgba(0,0,0,0.2);
      }

      .search-tabs {
          display: flex;
          gap: 10px;
          margin-bottom: 25px;
          flex-wrap: wrap;
      }

      .tab {
          padding: 12px 24px;
          border: 2px solid #e0e0e0;
          border-radius: 50px;
          background: white;
          cursor: pointer;
          transition: 0.3s;
          font-size: 15px;
          font-weight: 500;
          color: #555;
      }

      .tab.active {
          background: linear-gradient(135deg, #8EB486, #1C6758);
          color: white;
          border-color: transparent;
          box-shadow: 0 4px 15px rgba(0,0,0,0.15);
      }

      .tab:hover {
          border-color: #8EB486;
      }

      .search-form {
          display: none;
      }

      .search-form.active {
          display: block;
      }

      .search-row {
          display: flex;
          gap: 10px;
          margin-bottom: 15px;
          flex-wrap: wrap;
      }

      .search-row input, .search-row select {
          flex: 1;
          min-width: 200px;
          padding: 15px 20px;
          border: 2px solid #e0e0e0;
          border-radius: 50px;
          font-size: 15px;
          font-weight: 500;
          outline: none;
          transition: 0.3s;
          background: white;
      }

      .search-row input:focus, .search-row select:focus {
          border-color: #8EB486;
          box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.1);
      }

      .search-button {
          padding: 15px 40px;
          background: linear-gradient(135deg, #8EB486, #1C6758);
          color: white;
          border: none;
          border-radius: 50px;
          cursor: pointer;
          font-size: 16px;
          font-weight: 600;
          transition: 0.3s;
          box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      }

      .search-button:hover {
          transform: translateY(-2px);
          box-shadow: 0 6px 20px rgba(78, 205, 196, 0.4);
      }

      .suggestion-tags {
          margin-top: 20px;
          padding-top: 20px;
          border-top: 2px solid #e0e0e0;
      }

      .suggestion-tags p {
          color: #555;
          margin-bottom: 12px;
          font-size: 15px;
          font-weight: 500;
      }

      .tags-container {
          display: flex;
          gap: 10px;
          flex-wrap: wrap;
      }

      .tag-item {
          padding: 10px 20px;
          background: #f5f5f5;
          border-radius: 25px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          transition: 0.3s;
          color: #555;
      }

      .tag-item:hover {
          background: linear-gradient(135deg, #8EB486, #1C6758);
          color: white;
          transform: translateY(-2px);
          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      }

      /* Main Content Layout */
      .container {
          max-width: 1400px;
          margin: 40px auto;
          padding: 0 20px;
      }

      .section-title {
          text-align: center;
          font-size: 2.2em;
          font-weight: 700;
          color: #333;
          margin-bottom: 35px;
          font-family: 'Poppins', sans-serif;
      }

      /* ƒê·∫£m b·∫£o layout 1fr 400px ƒë∆∞·ª£c gi·ªØ */
      .content-layout {
          display: grid;
          grid-template-columns: 1fr 400px;
          gap: 30px;
          margin-bottom: 60px;
      }

      /* Left: Destinations Grid */
      .destinations-grid {
          display: grid;
          /* Thi·∫øt l·∫≠p 3 c·ªôt c·ªë ƒë·ªãnh theo y√™u c·∫ßu */
          grid-template-columns: repeat(3, 1fr); 
          gap: 25px;
          grid-auto-rows: minmax(300px, auto);
      }

      .image-card {
          background: white;
          border-radius: 15px;
          overflow: hidden;
          box-shadow: 0 5px 20px rgba(0,0,0,0.08);
          cursor: pointer;
          transition: 0.3s;
      }

      .image-card:hover {
          transform: translateY(-8px);
          box-shadow: 0 15px 35px rgba(0,0,0,0.15);
      }

      .image-card img {
          width: 100%;
          height: 220px;
          object-fit: cover;
      }

      .image-info { 
          padding: 18px; 
      }

      .image-info h3 { 
          margin-bottom: 8px;
          color: #333;
          font-size: 18px;
          font-weight: 600;
          font-family: 'Poppins', sans-serif;
      }

      .tags { 
          color: #8EB486; 
          font-size: 13px;
          margin-bottom: 5px;
          font-weight: 500;
      }

      .rating {
          color: #FFB800;
          font-size: 14px;
          font-weight: 600;
      }

      /* Pagination */
      .pagination {
          display: flex;
          justify-content: center;
          align-items: center;
          gap: 15px;
          margin-top: 30px;
      }

      .pagination button {
          padding: 12px 24px;
          background: white;
          border: 2px solid #1C6758;
          border-radius: 8px;
          color: #1C6758;
          font-weight: 600;
          cursor: pointer;
          transition: 0.3s;
      }

      .pagination button:hover:not(:disabled) {
          background: #1C6758;
          color: white;
      }

      .pagination button:disabled {
          opacity: 0.4;
          cursor: not-allowed;
      }

      .pagination .page-info {
          font-weight: 600;
          color: #333;
      }

      .sidebar {
          display: flex;
          flex-direction: column;
          gap: 20px;
          /* position: sticky;
          top: 90px;
          height: fit-content; */
      }

      .sidebar-card {
          background: white;
          border-radius: 15px;
          padding: 20px;
          box-shadow: 0 5px 20px rgba(0,0,0,0.08);
      }

      .sidebar-card h3 {
          font-size: 18px;
          font-weight: 600;
          margin-bottom: 15px;
          color: #1C6758;
          display: flex;
          align-items: center;
          gap: 8px;
      }

      /* Friends Online */
      .friends-list {
          display: flex;
          flex-direction: column;
          gap: 12px;
          max-height: 300px;
          overflow-y: auto; 
      }

      .friend-item {
          display: flex;
          align-items: center;
          gap: 10px;
          padding: 8px;
          border-radius: 8px;
          transition: 0.2s;
      }

      .friend-item:hover {
          background: #f5f5f5;
      }

      .friend-avatar {
          width: 40px;
          height: 40px;
          border-radius: 50%;
          background: linear-gradient(135deg, #8EB486, #1C6758);
          display: flex;
          align-items: center;
          justify-content: center;
          color: white;
          font-weight: 600;
          position: relative;
      }

      .status-dot {
          position: absolute;
          bottom: 0;
          right: 0;
          width: 12px;
          height: 12px;
          border-radius: 50%;
          border: 2px solid white;
      }

      .status-dot.online {
          background: #4ade80;
      }

      .status-dot.offline {
          background: #94a3b8;
      }

      .friend-name {
          font-weight: 500;
          color: #333;
          font-size: 14px;
      }

      /* Map Container */
      .map-container {
          width: 100%;
          height: 400px;
          border-radius: 12px;
          overflow: hidden;
          background: #e5e7eb;
          position: relative;
      }

      .map-container #miniMap {
          width: 100%;
          height: 100%;
          border-radius: 12px;
      }

      .map-link-btn {
          position: absolute;
          bottom: 10px;
          right: 10px;
          background: white;
          border: 2px solid #1C6758;
          padding: 8px 16px;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 600;
          color: #1C6758;
          cursor: pointer;
          z-index: 1000;
          box-shadow: 0 2px 8px rgba(0,0,0,0.2);
          transition: 0.3s;
      }

      .map-link-btn:hover {
          background: #1C6758;
          color: white;
      }

      .no-results { 
          text-align: center; 
          padding: 60px 20px; 
          color: #999;
          font-size: 18px;
          grid-column: 1 / -1;
      }

      /* Footer */
      footer {
          background: #2C3E50;
          color: white;
          padding: 50px 20px 20px;
          margin-top: 80px;
      }

      .footer-container {
          max-width: 1400px;
          margin: 0 auto;
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
          gap: 40px;
          margin-bottom: 30px;
      }

      .footer-section h3 {
          margin-bottom: 20px;
          color: #8EB486;
          font-weight: 600;
          font-size: 18px;
      }

      .footer-section p, .footer-section li {
          line-height: 1.8;
          color: #bbb;
          margin-bottom: 10px;
          font-size: 14px;
      }

      .footer-bottom {
          text-align: center;
          padding-top: 30px;
          border-top: 1px solid #444;
          color: #888;
      }

      /* Scroll Top Button */
      #scrollTop {
          position: fixed;
          bottom: 30px;
          right: 30px;
          background: linear-gradient(135deg, #1C6758, #8EB486);
          color: white;
          width: 50px;
          height: 50px;
          border-radius: 50%;
          border: none;
          cursor: pointer;
          font-size: 20px;
          display: none;
          box-shadow: 0 5px 15px rgba(0,0,0,0.3);
          transition: 0.3s;
          z-index: 999;
      }

      #scrollTop:hover {
          transform: translateY(-5px);
      }

      #scrollTop.show {
          display: block;
      }

      /* Responsive */
      @media (max-width: 1024px) {
          .content-layout {
              grid-template-columns: 1fr;
          }

          .sidebar {
              position: relative;
              top: 0;
              flex-direction: row;
          }

          .sidebar-card {
              flex: 1;
          }

          .destinations-grid {
              grid-template-columns: repeat(2, 1fr);
          }
      }

      @media (max-width: 768px) {
          .hero h1 {
              font-size: 2em;
          }

          .search-row {
              flex-direction: column;
          }

          .search-row input {
              min-width: 100%;
          }

          .nav-links {
              flex-wrap: wrap;
              gap: 10px;
          }

          .sidebar {
              flex-direction: column;
          }

          .destinations-grid {
              grid-template-columns: 1fr;
          }
      }
  </style>
</head>
<body>

  <header>
      <div class="header-container">
          <a href="/" class="logo">Loca<span>Go!</span></a>
          <div class="nav-links">
              <a href="/MapRouting">B·∫£n ƒë·ªì du l·ªãch</a>
              <a href="/chat_ui">Chatbot du l·ªãch</a>
              <a href="/forum">Forum</a>
              <a href="/friends_map">Friends map</a>

              {% if current_user.is_authenticated %}
                  <span class="nav-user">
                      Xin ch√†o, {{ current_user.username }}
                  </span>
              {% else %}
                  <a href="{{ url_for('login_bp.login') }}" class="btn-primary">ƒêƒÉng nh·∫≠p</a>
              {% endif %}

              <button class="hamburger-btn" onclick="toggleMenu()">
                  <i class="fas fa-bars"></i>
              </button>
              <div class="dropdown-menu" id="dropdownMenu">
                  <a href="{{ url_for('favorite_bp.list_favorites') }}"><i class="fas fa-heart"></i> Danh s√°ch y√™u th√≠ch</a>
                  <a href="/friends"><i class="fas fa-user-friends"></i> B·∫°n b√®</a>
                  {% if current_user.is_authenticated %}
                    <a href="{{ url_for('login_bp.logout') }}"><i class="fas fa-sign-out-alt"></i> ƒêƒÉng xu·∫•t</a>
                  {% endif %}              
                </div>
          </div>
      </div>
  </header>

  <section class="hero">
      <div class="hero-slideshow">
          <div class="hero-slide active" style="background-image: url('https://images.unsplash.com/photo-1528127269322-539801943592?w=1920');"></div>
          <div class="hero-slide" style="background-image: url('https://images.unsplash.com/photo-1583417319070-4a69db38a482?w=1920');"></div>
          <div class="hero-slide" style="background-image: url('https://images.unsplash.com/photo-1559592413-7cec4d0cae2b?w=1920');"></div>
          <div class="hero-slide" style="background-image: url('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=1920');"></div>
      </div>
      <div class="hero-overlay"></div>
      <div class="hero-content">
          <h1>Kh√°m ph√° phi√™n b·∫£n tuy·ªát nh·∫•t c·ªßa b·∫°n!</h1>
          <p>M·ªü ra ch√¢n tr·ªùi m·ªõi, ƒëam m√™ m·ªõi v√† ƒë√°nh th·ª©c phi√™n b·∫£n r·ª±c r·ª° c·ªßa b·∫°n c√πng LocaGo!</p>

          <div class="search-container">
              <div class="search-tabs">
                  <div class="tab active" onclick="switchTab('keyword')">T·ª´ kh√≥a</div>
                  <div class="tab" onclick="switchTab('filter')">Th√†nh ph·ªë & Th·∫ª</div>
                  <div class="tab" onclick="switchTab('ai')">T√¨m b·∫±ng AI</div>
                  <div class="tab" onclick="switchTab('image')">T√¨m b·∫±ng h√¨nh ·∫£nh</div>
              </div>

              <div id="keyword" class="search-form active">
                  <div class="search-row">
                      <input type="text" id="searchInput" placeholder="Nh·∫≠p t·ª´ kh√≥a: sea, forest, mountain...">
                      <button class="search-button" onclick="searchImages()">T√¨m ki·∫øm</button>
                  </div>
              </div>

              <div id="filter" class="search-form">
                  <div class="search-row">
                      <input type="text" id="cityInput" placeholder="Th√†nh ph·ªë (VD: H√† N·ªôi)">
                      <input type="text" id="tagInput" placeholder="Th·∫ª (VD: l·ªãch s·ª≠, bi·ªÉn)">
                      <input type="number" id="ratingInput" min="0" max="5" step="0.5" placeholder="ƒêi·ªÉm ƒë√°nh gi√°">
                      <button class="search-button" onclick="searchFilter()">L·ªçc</button>
                  </div>
              </div>

              <div id="ai" class="search-form">
                  <div class="search-row">
                      <input type="text" id="queryText" placeholder="VD: ƒë·ªãa ƒëi·ªÉm c√≥ nhi·ªÅu c√¢y xanh, g·∫ßn bi·ªÉn...">
                      <button class="search-button" onclick="searchText()">T√¨m b·∫±ng AI</button>
                  </div>
              </div>

              <div id="image" class="search-form">
                  <div class="search-row">
                      <input type="file" id="imageUpload" accept="image/*" style="padding: 12px;">
                      <button class="search-button" onclick="searchByImage()">T√¨m b·∫±ng ·∫£nh</button>
                  </div>
              </div>

              <div class="suggestion-tags">
                  <p>üí° G·ª£i √Ω t√¨m ki·∫øm ph·ªï bi·∫øn:</p>
                  <div class="tags-container">
                      <span class="tag-item" onclick="quickSearch('ngh·ªâ d∆∞·ª°ng')">ngh·ªâ d∆∞·ª°ng</span>
                      <span class="tag-item" onclick="quickSearch('mi·ªÅn T√¢y')">mi·ªÅn T√¢y</span>
                      <span class="tag-item" onclick="quickSearch('thi√™n nhi√™n')">thi√™n nhi√™n</span>
                      <span class="tag-item" onclick="quickSearch('bi·ªÉn')">bi·ªÉn</span>
                      <span class="tag-item" onclick="quickSearch('n√∫i')">n√∫i</span>
                      <span class="tag-item" onclick="quickSearch('vƒÉn h√≥a')">vƒÉn h√≥a</span>
                      <span class="tag-item" onclick="quickSearch('·∫©m th·ª±c')">·∫©m th·ª±c</span>
                      <span class="tag-item" onclick="quickSearch('l·ªãch s·ª≠')">l·ªãch s·ª≠</span>
                  </div>
              </div>
          </div>
      </div>
  </section>

  <div class="container">
      <h2 class="section-title">Kh√°m ph√° ƒëi·ªÉm ƒë·∫øn</h2>
      
      <div class="content-layout">
          <div>
              <div class="destinations-grid" id="results">
                  <div class="no-results">ƒêang t·∫£i d·ªØ li·ªáu...</div>
              </div>
              
              <div class="pagination">
                  <button id="prevBtn" onclick="previousPage()" disabled>
                      <i class="fas fa-chevron-left"></i> Tr∆∞·ªõc
                  </button>
                  <span class="page-info">
                      Trang <input type="number" id="pageInput" min="1" value="1"
                            onchange="goToPage(this.value)"
                            style="width: 50px; text-align: center; border: 2px solid #1C6758; border-radius: 5px; padding: 5px; font-weight: 600;"> 
                      / <span id="totalPages">1</span>
                  </span>
                  <button id="nextBtn" onclick="nextPage()">
                      Ti·∫øp <i class="fas fa-chevron-right"></i>
                  </button>
              </div>
          </div>

          <div class="sidebar">
              <!-- div class="sidebar-card">
                  <h3><i class="fas fa-user-friends"></i> B·∫°n b√® Online</h3>
                  <div class="friends-list" id="friendsList">
                      <div class='friend-item'>ƒêang t·∫£i d·ªØ li·ªáu b·∫°n b√®...</div>
                  </div>
              </div> -->

              <div class="sidebar-card">
                  <h3><i class="fas fa-map-marked-alt"></i> B·∫£n ƒë·ªì Vi·ªát Nam</h3>
                  <div class="map-container">
                      <div id="miniMap"></div>
                      <button class="map-link-btn" onclick="window.location.href='/MapRouting'">
                          <i class="fas fa-expand"></i> Xem ƒë·∫ßy ƒë·ªß
                      </button>
                  </div>
              </div>
          </div>
      </div>
  </div>

  <footer>
      <div class="footer-container">
          <div class="footer-section">
              <h3>V·ªÅ LocaGo!</h3>
              <p>24127552 - Nguy·ªÖn V√µ Nh·∫≠t Thu·∫≠n</p>
              <p>24127386 - V≈© ƒê·ªó M·∫°nh H√πng</p>
              <p>24127248 - Nguy·ªÖn Tr·∫ßn Ph∆∞∆°ng Th√∫y</p>
              <p>24127086 - Tr·∫ßn Ho√†ng Kh√°nh My</p>
              <p>24127302 - Nguy·ªÖn Xu√¢n Quy√™n</p>
              <p>24127106 - Lai Ph·∫°m Nh∆∞ Ph√∫c</p>
              <p>24127207 - Nguy·ªÖn Th·ª•c Nghi</p>
              <p style="margin-top: 15px;">H√£y ƒë·ªÉ ch√∫ng t√¥i ƒë·ªìng h√†nh c√πng b·∫°n trong m·ªçi h√†nh tr√¨nh!</p>
          </div>

          <div class="footer-section">
              <h3>Th√¥ng tin m√¥n h·ªçc</h3>
              <p><strong>M√¥n:</strong> T∆∞ duy t√≠nh to√°n</p>
              <p><strong>M√£ m√¥n:</strong> CSC10014</p>
              <p><strong>Gi·∫£ng vi√™n:</strong> L√™ Ng·ªçc Th√†nh</p>
              <p><strong>           </strong> Hu·ª≥nh L√¢m H·∫£i ƒêƒÉng</p>
              <p><strong>           </strong> Nguy·ªÖn Thanh T√¨nh</p>
              <p><strong>Tr∆∞·ªùng:</strong> ƒê·∫°i h·ªçc Khoa h·ªçc t·ª± nhi√™n, ƒêHQG-HCM</p>
          </div>

          <div class="footer-section">
              <h3>Li√™n h·ªá</h3>
              <p>Email: locago@hcmus.edu.vn</p>
              <p>Hotline: 1900 1010</p>
              <p>ƒê·ªãa ch·ªâ: 227, Nguy·ªÖn VƒÉn C·ª´, P.Ch·ª£ Qu√°n, TP.HCM</p>
          </div>
      </div>

      <div class="footer-bottom">
          <p>¬© 2025 LocaGo! - All Rights Reserved | Designed with ‚ù§Ô∏è for travelers</p>
      </div>
  </footer>

  <button id="scrollTop" onclick="scrollToTop()">‚Üë</button>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
      /* --- GLOBAL VARIABLES & CONFIG --- */
      let ALL_DESTINATIONS = []; // L∆∞u tr·ªØ t·∫•t c·∫£ k·∫øt qu·∫£ t√¨m ki·∫øm
      const DESTINATIONS_PER_PAGE = 9; // 3 h√†ng x 3 c·ªôt
      let CURRENT_PAGE = 1;
      const CURRENT_USER_ID = 1; 

      /* --- SLIDESHOW & MENU FUNCTIONS  --- */

      let currentSlide = 0;
      const slides = document.querySelectorAll('.hero-slide');
      
      function nextSlide() {
          slides[currentSlide].classList.remove('active');
          currentSlide = (currentSlide + 1) % slides.length;
          slides[currentSlide].classList.add('active');
      }

      function goToPage(pageNum) {
        const totalPages = Math.ceil(ALL_DESTINATIONS.length / DESTINATIONS_PER_PAGE);  
        pageNum = parseInt(pageNum);

        if (isNaN(pageNum) || pageNum < 1) {
             pageNum = 1;
        } else if (pageNum > totalPages) {
        pageNum = totalPages;
        }

        CURRENT_PAGE = pageNum;
        document.getElementById('pageInput').value = pageNum; // C·∫≠p nh·∫≠t l·∫°i input
        renderPage();
        }

      
      setInterval(nextSlide, 3000);

      function toggleMenu() {
          const menu = document.getElementById('dropdownMenu');
          menu.classList.toggle('show');
      }

      document.addEventListener('click', function(event) {
          const menu = document.getElementById('dropdownMenu');
          const hamburger = document.querySelector('.hamburger-btn');
          if (!menu.contains(event.target) && !hamburger.contains(event.target)) {
              menu.classList.remove('show');
          }
      });

      function switchTab(tabName) {
          document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.search-form').forEach(f => f.classList.remove('active'));
          
          event.target.classList.add('active');
          document.getElementById(tabName).classList.add('active');
      }

      function quickSearch(keyword) {
          document.getElementById('searchInput').value = keyword;
          document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.search-form').forEach(f => f.classList.remove('active'));
          document.querySelector('.tab').classList.add('active');
          document.getElementById('keyword').classList.add('active');
          searchImages();
      }
      
      /* --- PAGINATION CORE FUNCTIONS --- */

      // H√†m hi·ªÉn th·ªã k·∫øt qu·∫£ cho trang hi·ªán t·∫°i 
      function renderPage() {
          const container = document.getElementById('results');
          const totalPages = Math.ceil(ALL_DESTINATIONS.length / DESTINATIONS_PER_PAGE);
          
          // C·∫≠p nh·∫≠t th√¥ng tin ph√¢n trang
          document.getElementById('totalPages').textContent = totalPages || 1;
         // document.getElementById('currentPage').textContent = CURRENT_PAGE;
          document.getElementById('pageInput').value = CURRENT_PAGE;
          document.getElementById('pageInput').max = totalPages || 1;
         
          // V√¥ hi·ªáu h√≥a/K√≠ch ho·∫°t n√∫t
          document.getElementById('prevBtn').disabled = CURRENT_PAGE === 1;
          document.getElementById('nextBtn').disabled = CURRENT_PAGE >= totalPages;
          document.querySelector('.pagination').style.display = ALL_DESTINATIONS.length > 0 ? 'flex' : 'none';

          if (!ALL_DESTINATIONS || ALL_DESTINATIONS.length === 0) {
              container.innerHTML = '<div class="no-results">Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ n√†o.</div>';
              return;
          }

          // T√≠nh to√°n index b·∫Øt ƒë·∫ßu v√† k·∫øt th√∫c
          const startIndex = (CURRENT_PAGE - 1) * DESTINATIONS_PER_PAGE;
          const endIndex = startIndex + DESTINATIONS_PER_PAGE;
          const destinationsToShow = ALL_DESTINATIONS.slice(startIndex, endIndex);

          // Hi·ªÉn th·ªã k·∫øt qu·∫£ (3 c·ªôt, t·ªëi ƒëa 3 h√†ng)
          container.innerHTML = destinationsToShow.map(place => `
              <div class="image-card" onclick="viewDetail(${place.id})">
                  <img src="${place.filename?.includes('://') ? place.filename : `/static/images/${place.filename || 'default.jpg'}`}"
                       alt="${place.name || 'H√¨nh ·∫£nh'}"
                       onerror="this.src='https://via.placeholder.com/280x220?text=LocaGo'">
                  <div class="image-info">
                      <h3>${place.name || 'Ch∆∞a c√≥ t√™n'}</h3>
                      <div class="tags">${place.city || ''} ${place.tags ? '- ' + place.tags : ''}</div>
                      <div class="rating">‚≠ê ${place.rating || '0'}</div>
                  </div>
              </div>
          `).join('');
          
          // Cu·ªôn l√™n ƒë·∫ßu ph·∫ßn ƒë·ªãa danh sau khi chuy·ªÉn trang
          const contentLayout = document.querySelector('.content-layout');
          if (contentLayout) {
              contentLayout.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
      }

      function nextPage() {
          const totalPages = Math.ceil(ALL_DESTINATIONS.length / DESTINATIONS_PER_PAGE);
          if (CURRENT_PAGE < totalPages) {
              CURRENT_PAGE++;
              renderPage();
          }
      }

      function previousPage() {
          if (CURRENT_PAGE > 1) {
              CURRENT_PAGE--;
              renderPage();
          }
      }

      /* --- SEARCH FUNCTIONS  --- */

      async function processSearch(apiCall, errorMessage) {
          try {
              const res = await apiCall();
              const data = await res.json();
              
              ALL_DESTINATIONS = data; // L∆∞u t·∫•t c·∫£ k·∫øt qu·∫£
              CURRENT_PAGE = 1; // Reset v·ªÅ trang 1
              renderPage(); // Hi·ªÉn th·ªã trang ƒë·∫ßu ti√™n
              
          } catch (error) {
              console.error(`L·ªói t√¨m ki·∫øm (${errorMessage}):`, error);
              document.getElementById('results').innerHTML = 
                  `<div class="no-results">${errorMessage}. Vui l√≤ng th·ª≠ l·∫°i.</div>`;
              ALL_DESTINATIONS = [];
              renderPage(); // Hi·ªÉn th·ªã trang tr·ªëng v√† ·∫©n n√∫t ph√¢n trang
          }
      }

      async function searchImages() {
          const query = document.getElementById('searchInput').value.trim();
          await processSearch(
              () => fetch(`/api/search?q=${encodeURIComponent(query)}`),
              'ƒê√£ x·∫£y ra l·ªói khi t√¨m ki·∫øm t·ª´ kh√≥a'
          );
          console.log('T·ªïng s·ªë ƒë·ªãa ƒëi·ªÉm:', ALL_DESTINATIONS.length);
          console.log('D·ªØ li·ªáu nh·∫≠n ƒë∆∞·ª£c:', ALL_DESTINATIONS);
      }

      async function searchFilter() {
          const city = document.getElementById('cityInput').value.trim();
          const tag = document.getElementById('tagInput').value.trim();
          const rating = document.getElementById('ratingInput').value.trim() || 0;
          const url = `/search_filter?city=${encodeURIComponent(city)}&tag=${encodeURIComponent(tag)}&rating=${rating}`;
          
          await processSearch(
              () => fetch(url),
              'ƒê√£ x·∫£y ra l·ªói khi l·ªçc'
          );
      }

      async function searchText() {
          const query = document.getElementById('queryText').value.trim();
          if (!query) {
              alert('Vui l√≤ng nh·∫≠p n·ªôi dung t√¨m ki·∫øm!');
              return;
          }
          await processSearch(
              () => fetch(`/search_text?query=${encodeURIComponent(query)}`),
              'ƒê√£ x·∫£y ra l·ªói khi t√¨m ki·∫øm AI'
          );
      }

      async function searchByImage() {
          const fileInput = document.getElementById('imageUpload');
          const file = fileInput.files[0];
          
          if (!file) {
              alert('Vui l√≤ng ch·ªçn m·ªôt h√¨nh ·∫£nh!');
              return;
          }

          const formData = new FormData();
          formData.append('file', file);

          try {
              const res = await fetch('/search_image', {
                  method: 'POST',
                  body: formData
              });
              
              if (res.headers.get('content-type').includes('text/html')) {
                  window.location.href = '/search_image';
                  return;
              }
              
              const data = await res.json();
              ALL_DESTINATIONS = data;
              CURRENT_PAGE = 1;
              renderPage();
          } catch (error) {
              console.error('L·ªói t√¨m ki·∫øm ·∫£nh:', error);
              document.getElementById('results').innerHTML = 
                  '<div class="no-results">ƒê√£ x·∫£y ra l·ªói khi t√¨m ki·∫øm b·∫±ng ·∫£nh. Vui l√≤ng th·ª≠ l·∫°i.</div>';
          }
      }
      
      /* --- FRIENDS FUNCTION --- */

      async function loadFriendsForSidebar() {
          const container = document.getElementById("friendsList");
          container.innerHTML = "<div class='friend-item'>ƒêang t·∫£i d·ªØ li·ªáu b·∫°n b√®...</div>";

          const userId = CURRENT_USER_ID || 0;
          if (!userId) {
              container.innerHTML = "<div class='friend-item'>Ch∆∞a ƒëƒÉng nh·∫≠p</div>";
              return;
          }

          try {
              // G·ªçi API ƒë√£ c√≥ trong backend 
              const res = await fetch(`/friends/list/${userId}`);
              
              if (!res.ok) {
                   // X·ª≠ l√Ω l·ªói ho·∫∑c tr·∫£ v·ªÅ danh s√°ch r·ªóng n·∫øu kh√¥ng c√≥ d·ªØ li·ªáu
                   container.innerHTML = "<div class='friend-item'>L·ªói t·∫£i d·ªØ li·ªáu b·∫°n b√®.</div>";
                   return;
              }
              
              const data = await res.json();
              const friends = data.friends || []; // L·∫•y danh s√°ch b·∫°n b√®

              container.innerHTML = "";

              if (friends.length === 0) {
                  container.innerHTML = "<div class='friend-item'>Kh√¥ng c√≥ b·∫°n b√®</div>";
              } else {
                  friends.forEach(f => {
                      const initial = (f.username && f.username.charAt(0)) ? f.username.charAt(0).toUpperCase() : '?';
                      container.innerHTML += `
                          <div class="friend-item">
                              <div class="friend-avatar">
                                  ${initial}
                                  <span class="status-dot ${f.is_online ? 'online' : 'offline'}"></span>
                              </div>
                              <span class="friend-name">${f.username || 'Ng∆∞·ªùi d√πng ·∫©n'}</span>
                          </div>
                      `;
                  });
              }

          } catch (e) {
              console.error("L·ªói t·∫£i b·∫°n b√®:", e);
              container.innerHTML = "<div class='friend-item'>L·ªói k·∫øt n·ªëi server</div>";
          }
      }

      /* --- MAP FUNCTIONS --- */
      function initMiniMap() {
          const miniMap = L.map('miniMap', {
              zoomControl: true,
              scrollWheelZoom: false
          }).setView([16.0544, 108.2022], 6);

          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
              attribution: '¬© OpenStreetMap contributors',
              maxZoom: 18
          }).addTo(miniMap);

          const popularPlaces = [
              { name: 'H√† N·ªôi', lat: 21.0285, lon: 105.8542 },
              { name: 'H·∫° Long', lat: 20.9601, lon: 107.0432 },
              { name: 'Sa Pa', lat: 22.3364, lon: 103.8438 },
              { name: 'ƒê√† N·∫µng', lat: 16.0544, lon: 108.2022 },
              { name: 'H·ªôi An', lat: 15.8801, lon: 108.3380 },
              { name: 'Nha Trang', lat: 12.2388, lon: 109.1967 },
              { name: 'ƒê√† L·∫°t', lat: 11.9404, lon: 108.4583 },
              { name: 'TP.HCM', lat: 10.7769, lon: 106.7009 },
              { name: 'Ph√∫ Qu·ªëc', lat: 10.2897, lon: 103.9839 }
          ];

          const greenIcon = L.divIcon({
              html: '<i class="fas fa-map-marker-alt" style="color: #1C6758; font-size: 24px;"></i>',
              className: 'custom-marker',
              iconSize: [24, 24],
              iconAnchor: [12, 24]
          });

          popularPlaces.forEach(place => {
              L.marker([place.lat, place.lon], { icon: greenIcon })
                  .addTo(miniMap)
                  .bindPopup(`<b>${place.name}</b><br><small>Click ƒë·ªÉ xem chi ti·∫øt</small>`);
          });

          const bounds = L.latLngBounds(
              [8.5, 102.1],
              [23.4, 109.5]
          );
          miniMap.fitBounds(bounds);
      }

      function viewDetail(imageId) {
          // Gi·ªØ nguy√™n logic c≈© c·ªßa b·∫°n l√† chuy·ªÉn h∆∞·ªõng sang trang chi ti·∫øt
          window.location.href = '/image/' + imageId;
      }
      
      /* --- UTILS --- */

      window.onscroll = function() {
          const scrollBtn = document.getElementById('scrollTop');
          if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
              scrollBtn.classList.add('show');
          } else {
              scrollBtn.classList.remove('show');
          }
      };

      function scrollToTop() {
          window.scrollTo({
              top: 0,
              behavior: 'smooth'
          });
      }

      document.getElementById('searchInput').addEventListener('keypress', e => {
          if (e.key === 'Enter') searchImages();
      });

      document.getElementById('queryText').addEventListener('keypress', e => {
          if (e.key === 'Enter') searchText();
      });

      /* --- INITIAL LOAD --- */
      window.onload = async function() {
          // 1. T·∫£i ƒë·ªãa danh (s·∫Ω g·ªçi searchImages() -> renderPage() ƒë·ªÉ hi·ªÉn th·ªã trang 1)
          await searchImages(); 

          // 2. T·∫£i danh s√°ch b·∫°n b√®
          loadFriendsForSidebar(); 
          
          // 3. Initialize mini map
          initMiniMap();
      };
  </script>

</body>
</html>
